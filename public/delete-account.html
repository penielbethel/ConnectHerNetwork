<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Request Account Deletion – ConnectHer Network</title>
    <meta name="description" content="Use this page to request deletion of your ConnectHer Network account and associated data." />
    <style>
      :root {
        color-scheme: light dark;
        --bg: #0b0c10;
        --card: #1f2833;
        --text: #eaeaea;
        --muted: #c5c6c7;
        --accent: #66fcf1;
        --danger: #ff5a61;
        --border: #2b3440;
      }
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, sans-serif; margin: 0; background: var(--bg); color: var(--text); }
      .container { max-width: 720px; margin: 0 auto; padding: 32px 20px; }
      .card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 24px; box-shadow: 0 8px 24px rgba(0,0,0,0.18); }
      h1 { margin: 0 0 12px; font-size: 26px; }
      p.lead { margin: 0 0 20px; color: var(--muted); }
      form { display: grid; gap: 16px; }
      label { display: block; font-weight: 600; margin-bottom: 6px; }
      input, select, textarea { width: 100%; padding: 10px 12px; border-radius: 8px; border: 1px solid var(--border); background: #0f141a; color: var(--text); }
      textarea { min-height: 120px; resize: vertical; }
      .checkbox { display: flex; align-items: flex-start; gap: 10px; }
      .checkbox input { width: 18px; height: 18px; margin-top: 3px; }
      .actions { display: flex; gap: 12px; align-items: center; }
      button { background: var(--accent); color: #0b0c10; font-weight: 700; border: none; padding: 10px 16px; border-radius: 10px; cursor: pointer; }
      button[disabled] { opacity: 0.6; cursor: not-allowed; }
      .note { font-size: 14px; color: var(--muted); }
      .status { margin-top: 10px; font-size: 14px; }
      .status.success { color: #2ee5d5; }
      .status.error { color: var(--danger); }
      .muted-link { color: var(--accent); text-decoration: none; }
      .muted-link:hover { text-decoration: underline; }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="card">
        <h1>Request Account Deletion</h1>
        <p class="lead">Use this form to request deletion of your account and associated data. Our support team will confirm by email and process the request promptly.</p>

        <form id="deleteForm" aria-label="Account deletion request form">
          <div>
            <label for="email">Email address (required)</label>
            <input type="email" id="email" name="email" required autocomplete="email" placeholder="you@example.com" />
          </div>

          <div>
            <label for="username">Username (optional)</label>
            <input type="text" id="username" name="username" autocomplete="username" placeholder="your_username" />
          </div>

          <div>
            <label for="reason">Reason (optional)</label>
            <select id="reason" name="reason">
              <option value="">Select a reason…</option>
              <option>Prefer another platform</option>
              <option>Privacy concerns</option>
              <option>Duplicate account</option>
              <option>No longer needed</option>
              <option>Other</option>
            </select>
          </div>

          <div>
            <label for="details">Additional details (optional)</label>
            <textarea id="details" name="details" placeholder="Add any information to help us find and remove your data (e.g., registered phone number, any prior support case IDs)."></textarea>
          </div>

          <div class="checkbox">
            <input type="checkbox" id="consent" name="consent" required />
            <label for="consent">I confirm I want to delete my account and understand this action is irreversible.</label>
          </div>

          <div class="actions">
            <button type="submit" id="submitBtn">Submit deletion request</button>
            <span class="note">Or email <a class="muted-link" href="mailto:connecthernetwork01@gmail.com?subject=Account%20Deletion%20Request&body=Please%20delete%20my%20account%20and%20associated%20data.%0A%0AEmail:%20%3Cyour%20email%3E%0AUsername:%20%3Cyour%20username%3E%0AReason:%20%3Coptional%3E%0ADetails:%20%3Coptional%3E">connecthernetwork01@gmail.com</a></span>
          </div>
          <div id="status" class="status" role="status" aria-live="polite"></div>
        </form>
      </div>
    </div>

    <script>
      const form = document.getElementById('deleteForm');
      const statusEl = document.getElementById('status');
      const submitBtn = document.getElementById('submitBtn');

      function setStatus(message, type) {
        statusEl.textContent = message;
        statusEl.className = `status ${type || ''}`;
      }

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        setStatus('', '');
        submitBtn.disabled = true;

        const data = {
          email: document.getElementById('email').value.trim(),
          username: document.getElementById('username').value.trim(),
          reason: document.getElementById('reason').value,
          details: document.getElementById('details').value.trim(),
          consent: document.getElementById('consent').checked,
        };

        if (!data.email || !data.consent) {
          setStatus('Please provide your email and confirm consent.', 'error');
          submitBtn.disabled = false;
          return;
        }

        try {
          const res = await fetch('/api/delete-account', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data),
          });
          const json = await res.json();

          if (res.ok && json.success) {
            if (json.emailFallback) {
              setStatus('Request received. Email service is not configured; please click the link above to send your request by email.', 'success');
            } else {
              setStatus('Request sent. Our team will confirm by email.', 'success');
            }
            form.reset();
          } else {
            throw new Error(json.message || 'Failed to submit request');
          }
        } catch (err) {
          console.error(err);
          setStatus('Something went wrong. Please try again later or use the email link.', 'error');
        } finally {
          submitBtn.disabled = false;
        }
      });
    </script>
  </body>
  </html>